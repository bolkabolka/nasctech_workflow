#!/usr/bin/env ruby

require 'nasctech_workflow'
require 'nasctech_workflow/time_entry'
require 'nasctech_workflow/issue'

Slop.parse do
  on '-v', 'Print the version' do
    puts "Version #{NasctechWorkflow::VERSION}"
  end
  command 'resolve' do
    on :k, :keep, 'Keep functionality in branch, without merge.'
    on :t, :ticket=, 'Ticket number.', as: Integer

    run do |opts, args|
      # TODO parse ticket number from last commit
      raise "Ticket number can't be blank." unless opts[:ticket]

      issue = NasctechWorkflow::Issue.find opts[:ticket]
      issue.resolve! merged: !opts[:keep]
    end
  end
end

